<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elder Care Companion - Nurse Portal</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .portal-header {
            background: radial-gradient(circle at top right, var(--secondary-color), transparent);
            color: var(--text-color);
            padding: 30px;
            text-align: center;
            border-bottom: 2px solid var(--primary-color);
        }
    </style>
</head>

<body>
    <div class="container" style="background: var(--bg-color);">
        <div class="card fade-in"
            style="max-width: 900px; padding: 0; overflow: hidden; border: none; box-shadow: var(--card-shadow);">
            <div class="portal-header">
                <i class="fas fa-user-nurse"
                    style="font-size: 3rem; color: var(--primary-color); margin-bottom: 10px;"></i>
                <h2 style="margin: 0; color: var(--text-color);">Hospital / Nurse Portal</h2>
                <p style="color: var(--text-muted);">Authorized Medical Access & Control</p>
            </div>

            <div style="padding: 20px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Authoritative Prescriptions (Managed via Chatbot Intelligence) -->
                    <div class="card"
                        style="text-align: left; background: var(--card-bg); color: var(--text-color); border: 1px solid #ddd; opacity: 0.9;">
                        <h3><i class="fas fa-robot"></i> AI Prescription Assistant</h3>
                        <p class="mb-1" style="font-size: 0.9rem; color: #666;">
                            To prescribe medicines, use the <strong>Companion Chat</strong>. <br>
                            Example: <em>"Prescribe Metformin 500mg at 10:00 AM"</em>
                        </p>
                        <button onclick="window.location.href='chat.html'" class="secondary"
                            style="margin-top: 10px; font-size: 0.9rem;">
                            <i class="fas fa-comments"></i> Open Chat
                        </button>
                    </div>

                    <!-- Vitals Entry -->
                    <div class="card"
                        style="text-align: left; background: var(--card-bg); color: var(--text-color); border: 1px solid #ddd;">
                        <h3><i class="fas fa-heartbeat"></i> Update Vitals</h3>
                        <form id="vitalsForm">
                            <input type="number" id="vSys" placeholder="Systolic (e.g. 120)" required>
                            <input type="number" id="vDia" placeholder="Diastolic (e.g. 80)" required>
                            <input type="number" id="vSugar" placeholder="Blood Sugar (mg/dL)">
                            <button type="submit" class="secondary">Update & Sync</button>
                        </form>
                    </div>
                </div>

                <!-- Current Prescriptions List -->
                <div class="card" style="margin-top: 20px; text-align: left; border: 1px solid rgba(0,0,0,0.05);">
                    <h3 style="color: var(--text-color); margin-bottom: 15px;"><i class="fas fa-list-ul"
                            style="color: var(--primary-color);"></i> Current Prescriptions</h3>
                    <div id="prescList" style="margin-top: 15px;">
                        <!-- List of medicines will be injected here -->
                    </div>
                </div>

                <!-- Summary & Reports -->
                <div class="card"
                    style="margin-top: 20px; text-align: left; background: var(--secondary-color); border: none;">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;"><i class="fas fa-file-medical"></i>
                        Elder Health Summary</h3>
                    <div id="nurseSummary" style="margin-bottom: 15px; font-weight: 500;">
                        <!-- Summary injected here -->
                    </div>
                    <button onclick="window.location.href='health.html'" class="secondary"
                        style="background: white; color: var(--primary-color);">View Full Health Analytics</button>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="window.location.href='dashboard.html'" class="alert"
                        style="width: auto; padding: 12px 30px;">
                        <i class="fas fa-sign-out-alt"></i> Exit Nurse Portal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script>
        let editingMedId = null;

        document.addEventListener('DOMContentLoaded', () => {
            updateNurseSummary();
            loadPrescriptions();
        });

        // Manual form removed, but logic kept safe or removed

        function loadPrescriptions() {
            const reminders = JSON.parse(localStorage.getItem('elderReminders') || '[]');
            const container = document.getElementById('prescList');
            container.innerHTML = '';

            if (reminders.length === 0) {
                container.innerHTML = '<p style="color: #666; font-size: 0.9rem;">No prescriptions added yet.</p>';
                return;
            }

            reminders.forEach(r => {
                const item = document.createElement('div');
                item.className = 'card';
                item.style.padding = '10px';
                item.style.marginBottom = '10px';
                item.style.display = 'flex';
                item.style.justifyContent = 'space-between';
                item.style.alignItems = 'center';
                item.style.background = 'var(--card-bg)';
                item.style.color = 'var(--text-color)';
                item.style.border = '1px solid #eee';

                item.innerHTML = `
                    <div>
                        <strong>${r.name}</strong> - ${r.dosage}<br>
                        <small><i class="fas fa-clock"></i> ${r.time} ${r.source ? `(${r.source})` : ''}</small>
                    </div>
                    <div>
                        <button onclick="deletePrescription(${r.id})" style="padding: 5px 10px; font-size: 0.8rem; background: var(--error-color); color: white; border: none; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function deletePrescription(id) {
            let reminders = JSON.parse(localStorage.getItem('elderReminders') || '[]');
            reminders = reminders.filter(r => r.id !== id);
            localStorage.setItem('elderReminders', JSON.stringify(reminders));
            loadPrescriptions();
        }

        document.getElementById('vitalsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const logs = JSON.parse(localStorage.getItem('elderHealth') || '[]');
            logs.push({
                timestamp: Date.now(),
                date: new Date().toLocaleDateString(),
                sys: document.getElementById('vSys').value,
                dia: document.getElementById('vDia').value,
                sugar: document.getElementById('vSugar').value
            });
            localStorage.setItem('elderHealth', JSON.stringify(logs));
            alert("Vitals synced successfully.");
            e.target.reset();
            updateNurseSummary();
        });

        function updateNurseSummary() {
            const profile = JSON.parse(localStorage.getItem('elderProfile') || '{}');
            const data = JSON.parse(localStorage.getItem('elderHealth') || '[]');
            const container = document.getElementById('nurseSummary');

            if (data.length === 0) {
                container.innerHTML = `<p>Elder: <strong>${profile.name || 'N/A'}</strong>. No health logs available yet.</p>`;
            } else {
                const latest = data[data.length - 1];
                container.innerHTML = `
                    <p>Elder: <strong>${profile.name}</strong> (Age: ${profile.age})</p>
                    <p>Latest BP: <strong>${latest.sys}/${latest.dia}</strong> (Logged on ${latest.date})</p>
                    <p>Target: 120/80. Status: ${parseInt(latest.sys) > 130 ? '<span style="color:var(--error-color)">Needs Attention</span>' : '<span style="color:var(--success-color)">Stable</span>'}</p>
                `;
            }
        }
    </script>
</body>

</html>